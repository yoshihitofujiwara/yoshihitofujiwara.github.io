<!DOCTYPE html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>poseNet | ML5js</title>
	<link rel="stylesheet" href="assets/css/styles.css" media="all">

	<style>
		canvas{
			width: 100% !important;
			height: auto !important;
		}
	</style>
</head>

<body>
<script src="assets/js/libs.js"></script>
<script>
	let video;
	let poseNet;
	let poses = [];
	let skeletons = [];

	function setup() {
		createCanvas(640*1.5, 480 * 1.5);
		video = createCapture(VIDEO);
		video.size(width, height);

		// Create a new poseNet method with a single detection
		poseNet = ml5.poseNet(video, 'single', gotPoses);

		// Hide the video element, and just show the canvas
		video.hide();
	}

	function draw() {
		image(video, 0, 0, width, height);

		// We can call both functions to draw all keypoints and the skeletons
		drawKeypoints();
		drawSkeleton();
	}

	// A function to draw ellipses over the detected keypoints
	function drawKeypoints() {
		// Loop through all the poses detected
		for (let i = 0; i < poses.length; i++) {
			// For each pose detected, loop through all the keypoints
			for (let j = 0; j < poses[i].pose.keypoints.length; j++) {
				// A keypoint is an object describing a body part (like rightArm or leftShoulder)
				let keypoint = poses[i].pose.keypoints[j];
				// Only draw an ellipse is the pose probability is bigger than 0.2
				if (keypoint.score > 0.2) {
					fill(255, 0, 0);
					noStroke();
					ellipse(keypoint.position.x, keypoint.position.y, 10, 10);
				}
			}
		}
	}

	// A function to draw the skeletons
	function drawSkeleton() {
		// Loop through all the skeletons detected
		for (let i = 0; i < poses.length; i++) {
			// For every skeleton, loop through all body connections
			for (let j = 0; j < poses[i].skeleton.length; j++) {
				let partA = poses[i].skeleton[j][0];
				let partB = poses[i].skeleton[j][1];
				stroke(255, 0, 0);
				line(partA.position.x, partA.position.y, partB.position.x, partB.position.y);
			}
		}
	}

	// The callback that gets called every time there's an update from the model
	function gotPoses(results) {
		poses = results;
	}
</script>
<!-- <script src="assets/js/scripts.js"></script> -->
</body>
</html>
